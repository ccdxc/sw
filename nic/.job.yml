---
targets:
  main: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make clean && make -j4 all && make run-gtests && make clean ; ret=$? ; make sanity_logs ; exit $ret" ]
  halctl: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make clean && make -j4 all &&  cd $GOPATH/src/github.com/pensando/sw/nic/agent/cmd/halctl && go test" ]
  arm_build: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make clean && make ARCH=aarch64 nic && make ARCH=aarch64 sanity-tests && make ARCH=aarch64 gtests && make clean ; ret=$? ; make sanity_logs ; exit $ret" ]
  arm_haps_build: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make clean && make PLATFORM=haps ARCH=aarch64 nic && make PLATFORM=haps ARCH=aarch64 sanity-tests && make PLATFORM=haps ARCH=aarch64 gtests && make clean ; ret=$? ; make sanity_logs ; exit $ret" ]
  storage:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --storage ; ret=$? ; make sanity_logs ; exit $ret" ]
  # config:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --configtest ; ret=$? ; make sanity_logs ; exit $ret" ]
  rdma:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo rdma --feature rdma ; ret=$? ; make sanity_logs ; exit $ret" ]
  rdma_ext:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo rdma --feature rdma_ext,rdma_perf ; ret=$? ; make sanity_logs ; exit $ret" ]
  fte:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo fte --feature fte --lite ; ret=$? ; make sanity_logs ; exit $ret" ]
  fte2:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo fte --feature fte2 --lite ; ret=$? ; make sanity_logs ; exit $ret" ]
  ftevxlan:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo fte --feature ftevxlan --lite ; ret=$? ; make sanity_logs ; exit $ret" ]
  alg: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py --topo alg --feature alg ; ret=$? ; make sanity_logs ; exit $ret" ]
  norm: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo norm --feature norm ; ret=$? ; make sanity_logs ; exit $ret" ]
  eth:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo eth --feature eth ; ret=$? ; make sanity_logs ; exit $ret" ]
  acl:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo acl --feature acl ; ret=$? ; make sanity_logs ; exit $ret" ]
  proxy:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo proxy --feature proxy,proxy_fte,proxy_asym ; ret=$? ; make sanity_logs ; exit $ret" ]
  e2etlsproxy:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo proxy --feature proxy --config-only --e2e-tls-dol ; ret=$? ; make sanity_logs ; exit $ret" ]
  v6e2etlsproxy:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo proxy --feature proxy --config-only --v6-e2e-tls-dol ; ret=$? ; make sanity_logs ; exit $ret" ]
  e2enetworking:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo e2e --feature e2e --sub e2e --e2e-mode auto --cfgjson conf/dol.conf ; ret=$? ; make sanity_logs ; exit $ret" ]
  e2ealg: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo alg --feature e2e --sub alg --e2e-mode auto --cfgjson conf/dol.conf ; ret=$? ; make sanity_logs ; exit $ret" ]
  ipsec:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo proxy --feature ipsec --no_error_check ; ret=$? ; make sanity_logs ; exit $ret" ]
  networking:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo up2up --feature networking ; ret=$? ; make sanity_logs ; exit $ret" ]
  vxlan:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo vxlan --feature vxlan ; ret=$? ; make sanity_logs ; exit $ret" ]
  ipsg:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo eth --feature ipsg ; ret=$? ; make sanity_logs ; exit $ret" ]
  firewall:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo firewall --feature firewall ; ret=$? ; make sanity_logs ; exit $ret" ]
  # admin:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo admin --feature admin ; ret=$? ; make sanity_logs ; exit $ret" ]
  pin:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo fte --feature fte,hostpin --hostpin --lite ; ret=$? ; make sanity_logs ; exit $ret" ]
  pin2:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo fte --feature fte2 --hostpin --lite ; ret=$? ; make sanity_logs ; exit $ret" ]
  pinvxlan:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo fte --feature ftevxlan,hpvxlan --hostpin --lite ; ret=$? ; make sanity_logs ; exit $ret" ]
  agent: ["sh", "-c", "cd $GOPATH/src/github.com/pensando/sw && make pull-assets && make checks && cd nic && make nic && make sanity-tests && bash agent/netagent/scripts/sanity.sh ; ret=$? ; make sanity_logs ; exit $ret" ]
  agent-single-threaded: ["sh", "-c", "cd $GOPATH/src/github.com/pensando/sw && make pull-assets && make checks && cd nic && make nic && make sanity-tests && bash agent/netagent/scripts/sanity.sh single-threaded ; ret=$? ; make sanity_logs ; exit $ret" ]
  multicast:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo multicast --feature multicast ; ret=$? ; make sanity_logs ; exit $ret" ]
  pinl2mc:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo multicast --feature pinl2mc --hostpin ; ret=$? ; make sanity_logs ; exit $ret" ]
  l4lb:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo l4lb --feature l4lb ; ret=$? ; make sanity_logs ; exit $ret" ]
  dos:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo dos --feature dos ; ret=$? ; make sanity_logs ; exit $ret" ]
  recirc:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo recirc --feature recirc ; ret=$? ; make sanity_logs ; exit $ret" ]
  classic:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo classic --feature classic --classic ; ret=$? ; make sanity_logs ; exit $ret" ]
  classicl2mc:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo classic --feature classicl2mc --classic ; ret=$? ; make sanity_logs ; exit $ret" ]
  parser:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo parser --feature parser ; ret=$? ; make sanity_logs ; exit $ret" ]
  telemetry:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo telemetry --feature telemetry ; ret=$? ; make sanity_logs ; exit $ret" ]
  p4pt:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py --topo p4pt --feature p4pt ; ret=$? ; make sanity_logs ; exit $ret" ]
  app_redir:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo app_redir --feature app_redir ; ret=$? ; make sanity_logs ; exit $ret" ]
  e2el7:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo proxy --feature proxy --config-only --e2e-l7-dol ; ret=$? ; make sanity_logs ; exit $ret" ]
  mbt: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py --mbt && ./run.py --topo=up2up --feature=networking --mbt; ret=$? ; make sanity_logs ; exit $ret" ]
  # configtoggle: ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo up2up --feature networking --configtoggle ; ret=$? ; make sanity_logs ; exit $ret" ]
  gft/gtest:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make gft && ./run.py --gft_gtest && make run-gft-gtests ; ret=$? ; make sanity_logs ; exit $ret" ]
  gft:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make gft && ./run.py  --topo gft --feature gft --gft ; ret=$? ; make sanity_logs ; exit $ret" ]
  base:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo base --feature eth_base,nw_base,rdma_base,proxy_base --lite ; ret=$? ; make sanity_logs ; exit $ret" ]
  gft_rdma:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make gft && ./run.py  --topo rdma_gft --feature rdma_perf --gft ; ret=$? ; make sanity_logs ; exit $ret" ] 
  swphv:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make nic && make sanity-tests && ./run.py  --topo proxy --feature swphv" ]
  proto-sync: ["sh", "-c", "cd /sw && make pull-assets && cd $GOPATH/src/github.com/pensando/sw/nic/agent/netagent/datapath/halproto && make proto-sync" ]
  hal-rtl/parser:  ["sh", "-c", "cd /sw && make pull-assets && cd nic && make hal-rtl && ./run.py  --topo parser --feature parser ; ret=$? ; make sanity_logs ; exit $ret" ]
  agent-arm-xcompile: ["sh", "-c", "cd $GOPATH/src/github.com/pensando/sw make checks && env CGO_LDFLAGS=-L/tool/toolchain/aarch64-1.1/aarch64-linux-gnu/usr/include CC=/tool/toolchain/aarch64-1.1/bin/aarch64-linux-gnu-gcc CGO_ENABLED=1 GOOS=linux GOARCH=arm64 go build -a -v github.com/pensando/sw/nic/agent/cmd/netagent github.com/pensando/sw/nic/agent/cmd/nmd" ]

cache:
  name: "sw"
  mount_dir: "/root/.cache"
image:
  bind_dir: "/sw"
  work_dir: "/sw/nic"
rebase: true
logfiles:
  - /sw/nic/nic_sanity_logs.tar.gz
